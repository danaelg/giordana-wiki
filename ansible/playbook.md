---
title: Playbooks Ansible
description: 
published: true
date: 2023-07-05T07:41:04.077Z
tags: ansible, work-in-progress, ansible-playbook
editor: markdown
dateCreated: 2023-07-03T17:34:59.507Z
---

# Introduction
Les playbooks sont des fichiers texte YAML qui servent de plan pour exécuter des tâches sur une liste d'hôte définie par les fichiers d'[inventaire](/ansible/inventory). Comme pour des script *bash* ou *powershell* classique, quasiment toutes les actions peuvent être décrite dans des playbooks. La différence réside dans l'approche descriptive qui s'oppose à une approche plus itérative que l'on retrouve dans les scripts.

# Syntaxe
Voici un exemple de playbooks
```kroki
excalidraw
{
  "type": "excalidraw",
  "version": 2,
  "source": "https://excalidraw.com",
  "elements": [
    {
      "id": "n55O3tBfoIKXiZeZKm233",
      "type": "text",
      "x": 641,
      "y": 201,
      "width": 609.2666625976562,
      "height": 528,
      "angle": 0,
      "strokeColor": "#1e1e1e",
      "backgroundColor": "transparent",
      "fillStyle": "hachure",
      "strokeWidth": 1,
      "strokeStyle": "solid",
      "roughness": 1,
      "opacity": 100,
      "groupIds": [],
      "frameId": null,
      "roundness": null,
      "seed": 686948453,
      "version": 111,
      "versionNonce": 1767409541,
      "isDeleted": false,
      "boundElements": null,
      "updated": 1688542356318,
      "link": null,
      "locked": false,
      "text": "---\n- name: Update web servers\n  hosts: webservers\n  tasks:\n  - name: Ensure apache is at the latest version\n    ansible.builtin.yum:\n      name: httpd\n      state: latest\n  - name: Write the apache config file\n    ansible.builtin.template:\n      src: /srv/httpd.j2\n      dest: /etc/httpd.conf\n\n- name: Update db servers\n  hosts: databases\n  remote_user: root\n  tasks:\n  - name: Ensure postgresql is at the latest version\n    ansible.builtin.yum:\n      name: postgresql\n      state: latest\n",
      "fontSize": 20,
      "fontFamily": 3,
      "textAlign": "left",
      "verticalAlign": "top",
      "baseline": 523,
      "containerId": null,
      "originalText": "---\n- name: Update web servers\n  hosts: webservers\n  tasks:\n  - name: Ensure apache is at the latest version\n    ansible.builtin.yum:\n      name: httpd\n      state: latest\n  - name: Write the apache config file\n    ansible.builtin.template:\n      src: /srv/httpd.j2\n      dest: /etc/httpd.conf\n\n- name: Update db servers\n  hosts: databases\n  remote_user: root\n  tasks:\n  - name: Ensure postgresql is at the latest version\n    ansible.builtin.yum:\n      name: postgresql\n      state: latest\n",
      "lineHeight": 1.2,
      "isFrameName": false
    },
    {
      "id": "ALrGKoFfYiXTRRaRpylrj",
      "type": "line",
      "x": 570.9999999999999,
      "y": 486,
      "width": 2,
      "height": 260,
      "angle": 0,
      "strokeColor": "#e03131",
      "backgroundColor": "transparent",
      "fillStyle": "hachure",
      "strokeWidth": 2,
      "strokeStyle": "solid",
      "roughness": 1,
      "opacity": 100,
      "groupIds": [],
      "frameId": null,
      "roundness": {
        "type": 2
      },
      "seed": 1962412197,
      "version": 1180,
      "versionNonce": 38227685,
      "isDeleted": false,
      "boundElements": null,
      "updated": 1688542356318,
      "link": null,
      "locked": false,
      "points": [
        [
          0,
          0
        ],
        [
          -2,
          -260
        ]
      ],
      "lastCommittedPoint": null,
      "startBinding": null,
      "endBinding": null,
      "startArrowhead": null,
      "endArrowhead": null
    },
    {
      "type": "line",
      "version": 1282,
      "versionNonce": 1420175941,
      "isDeleted": false,
      "id": "_hGNds_IcLQVonjDv5Tf1",
      "fillStyle": "hachure",
      "strokeWidth": 2,
      "strokeStyle": "solid",
      "roughness": 1,
      "opacity": 100,
      "angle": 0,
      "x": 568.1062295691761,
      "y": 703.4073216203601,
      "strokeColor": "#e03131",
      "backgroundColor": "transparent",
      "width": 2,
      "height": 186,
      "seed": 892169963,
      "groupIds": [],
      "frameId": null,
      "roundness": {
        "type": 2
      },
      "boundElements": [],
      "updated": 1688542356318,
      "link": null,
      "locked": false,
      "startBinding": null,
      "endBinding": null,
      "lastCommittedPoint": null,
      "startArrowhead": null,
      "endArrowhead": null,
      "points": [
        [
          0,
          0
        ],
        [
          2,
          -186
        ]
      ]
    },
    {
      "id": "NXH-9YfSHuPO1UfCQinG6",
      "type": "line",
      "x": 649,
      "y": 301,
      "width": 0,
      "height": 87,
      "angle": 0,
      "strokeColor": "#1971c2",
      "backgroundColor": "transparent",
      "fillStyle": "hachure",
      "strokeWidth": 2,
      "strokeStyle": "solid",
      "roughness": 1,
      "opacity": 100,
      "groupIds": [],
      "frameId": null,
      "roundness": null,
      "seed": 1391121541,
      "version": 147,
      "versionNonce": 1339836555,
      "isDeleted": false,
      "boundElements": null,
      "updated": 1688542356318,
      "link": null,
      "locked": false,
      "points": [
        [
          0,
          0
        ],
        [
          0,
          87
        ]
      ],
      "lastCommittedPoint": null,
      "startBinding": null,
      "endBinding": null,
      "startArrowhead": null,
      "endArrowhead": null
    },
    {
      "type": "line",
      "version": 168,
      "versionNonce": 1632803237,
      "isDeleted": false,
      "id": "HMhsjmCo-ffL0lCxOA6Zm",
      "fillStyle": "hachure",
      "strokeWidth": 2,
      "strokeStyle": "solid",
      "roughness": 1,
      "opacity": 100,
      "angle": 0,
      "x": 648.4203998978669,
      "y": 397.259941348806,
      "strokeColor": "#1971c2",
      "backgroundColor": "transparent",
      "width": 0,
      "height": 87,
      "seed": 1425187685,
      "groupIds": [],
      "frameId": null,
      "roundness": null,
      "boundElements": [],
      "updated": 1688542356318,
      "link": null,
      "locked": false,
      "startBinding": null,
      "endBinding": null,
      "lastCommittedPoint": null,
      "startArrowhead": null,
      "endArrowhead": null,
      "points": [
        [
          0,
          0
        ],
        [
          0,
          87
        ]
      ]
    },
    {
      "type": "line",
      "version": 224,
      "versionNonce": 100204331,
      "isDeleted": false,
      "id": "P4M-8dZPy1iv6BmvfZrc_",
      "fillStyle": "hachure",
      "strokeWidth": 2,
      "strokeStyle": "solid",
      "roughness": 1,
      "opacity": 100,
      "angle": 0,
      "x": 646.6973285099443,
      "y": 616.5685174637474,
      "strokeColor": "#1971c2",
      "backgroundColor": "transparent",
      "width": 0,
      "height": 87,
      "seed": 108563019,
      "groupIds": [],
      "frameId": null,
      "roundness": null,
      "boundElements": [],
      "updated": 1688542356318,
      "link": null,
      "locked": false,
      "startBinding": null,
      "endBinding": null,
      "lastCommittedPoint": null,
      "startArrowhead": null,
      "endArrowhead": null,
      "points": [
        [
          0,
          0
        ],
        [
          0,
          87
        ]
      ]
    },
    {
      "id": "qj3p9dNPlk8rsqoUIm8K3",
      "type": "line",
      "x": 688,
      "y": 346,
      "width": 229,
      "height": 1,
      "angle": 0,
      "strokeColor": "#f08c00",
      "backgroundColor": "transparent",
      "fillStyle": "hachure",
      "strokeWidth": 2,
      "strokeStyle": "solid",
      "roughness": 1,
      "opacity": 100,
      "groupIds": [],
      "frameId": null,
      "roundness": null,
      "seed": 899932293,
      "version": 72,
      "versionNonce": 1350951371,
      "isDeleted": false,
      "boundElements": null,
      "updated": 1688542356318,
      "link": null,
      "locked": false,
      "points": [
        [
          0,
          0
        ],
        [
          229,
          1
        ]
      ],
      "lastCommittedPoint": null,
      "startBinding": null,
      "endBinding": null,
      "startArrowhead": null,
      "endArrowhead": null
    },
    {
      "type": "line",
      "version": 143,
      "versionNonce": 1285174373,
      "isDeleted": false,
      "id": "Gr9xFmsN9fdl-lVX_CCwI",
      "fillStyle": "hachure",
      "strokeWidth": 2,
      "strokeStyle": "solid",
      "roughness": 1,
      "opacity": 100,
      "angle": 0,
      "x": 689.9628852941878,
      "y": 441.3925941161943,
      "strokeColor": "#f08c00",
      "backgroundColor": "transparent",
      "width": 286,
      "height": 0,
      "seed": 1119877413,
      "groupIds": [],
      "frameId": null,
      "roundness": null,
      "boundElements": [],
      "updated": 1688542356318,
      "link": null,
      "locked": false,
      "startBinding": null,
      "endBinding": null,
      "lastCommittedPoint": null,
      "startArrowhead": null,
      "endArrowhead": null,
      "points": [
        [
          0,
          0
        ],
        [
          286,
          0
        ]
      ]
    },
    {
      "type": "line",
      "version": 250,
      "versionNonce": 144535659,
      "isDeleted": false,
      "id": "8FGDIDkRL6Gb8Z0NoaN0J",
      "fillStyle": "hachure",
      "strokeWidth": 2,
      "strokeStyle": "solid",
      "roughness": 1,
      "opacity": 100,
      "angle": 0,
      "x": 685.8970400356521,
      "y": 657.025776530175,
      "strokeColor": "#f08c00",
      "backgroundColor": "transparent",
      "width": 230,
      "height": 2,
      "seed": 1417302213,
      "groupIds": [],
      "frameId": null,
      "roundness": null,
      "boundElements": [],
      "updated": 1688542356318,
      "link": null,
      "locked": false,
      "startBinding": null,
      "endBinding": null,
      "lastCommittedPoint": null,
      "startArrowhead": null,
      "endArrowhead": null,
      "points": [
        [
          0,
          0
        ],
        [
          230,
          2
        ]
      ]
    },
    {
      "id": "BYAWgGYwch3HvIxm_SgMv",
      "type": "text",
      "x": 513,
      "y": 349,
      "width": 46.86666488647461,
      "height": 24,
      "angle": 0,
      "strokeColor": "#e03131",
      "backgroundColor": "transparent",
      "fillStyle": "hachure",
      "strokeWidth": 2,
      "strokeStyle": "solid",
      "roughness": 1,
      "opacity": 100,
      "groupIds": [],
      "frameId": null,
      "roundness": null,
      "seed": 2093097893,
      "version": 555,
      "versionNonce": 1853906885,
      "isDeleted": false,
      "boundElements": null,
      "updated": 1688542356318,
      "link": null,
      "locked": false,
      "text": "Play",
      "fontSize": 20,
      "fontFamily": 3,
      "textAlign": "left",
      "verticalAlign": "top",
      "baseline": 19,
      "containerId": null,
      "originalText": "Play",
      "lineHeight": 1.2,
      "isFrameName": false
    },
    {
      "type": "text",
      "version": 620,
      "versionNonce": 2030078661,
      "isDeleted": false,
      "id": "Zls-oyE_C5x3mMaPmtF7H",
      "fillStyle": "hachure",
      "strokeWidth": 2,
      "strokeStyle": "solid",
      "roughness": 1,
      "opacity": 100,
      "angle": 0,
      "x": 511.5666675567627,
      "y": 604,
      "strokeColor": "#e03131",
      "backgroundColor": "transparent",
      "width": 46.86666488647461,
      "height": 24,
      "seed": 1637974469,
      "groupIds": [],
      "frameId": null,
      "roundness": null,
      "boundElements": [],
      "updated": 1688542361713,
      "link": null,
      "locked": false,
      "fontSize": 20,
      "fontFamily": 3,
      "text": "Play",
      "textAlign": "left",
      "verticalAlign": "top",
      "containerId": null,
      "originalText": "Play",
      "lineHeight": 1.2,
      "baseline": 19
    },
    {
      "id": "SisErWWuE5XbgRDs-vPeT",
      "type": "text",
      "x": 578,
      "y": 337,
      "width": 58.58333206176758,
      "height": 24,
      "angle": 0,
      "strokeColor": "#1971c2",
      "backgroundColor": "transparent",
      "fillStyle": "hachure",
      "strokeWidth": 2,
      "strokeStyle": "solid",
      "roughness": 1,
      "opacity": 100,
      "groupIds": [],
      "frameId": null,
      "roundness": null,
      "seed": 1403059947,
      "version": 122,
      "versionNonce": 2102009637,
      "isDeleted": false,
      "boundElements": null,
      "updated": 1688542356318,
      "link": null,
      "locked": false,
      "text": "Tâche",
      "fontSize": 20,
      "fontFamily": 3,
      "textAlign": "left",
      "verticalAlign": "top",
      "baseline": 19,
      "containerId": null,
      "originalText": "Tâche",
      "lineHeight": 1.2,
      "isFrameName": false
    },
    {
      "type": "text",
      "version": 185,
      "versionNonce": 1799786923,
      "isDeleted": false,
      "id": "M2Ym6XU39EYT-qia2uvAO",
      "fillStyle": "hachure",
      "strokeWidth": 2,
      "strokeStyle": "solid",
      "roughness": 1,
      "opacity": 100,
      "angle": 0,
      "x": 579.7083339691162,
      "y": 427,
      "strokeColor": "#1971c2",
      "backgroundColor": "transparent",
      "width": 58.58333206176758,
      "height": 24,
      "seed": 1337108037,
      "groupIds": [],
      "frameId": null,
      "roundness": null,
      "boundElements": [],
      "updated": 1688542356318,
      "link": null,
      "locked": false,
      "fontSize": 20,
      "fontFamily": 3,
      "text": "Tâche",
      "textAlign": "left",
      "verticalAlign": "top",
      "containerId": null,
      "originalText": "Tâche",
      "lineHeight": 1.2,
      "baseline": 19
    },
    {
      "type": "text",
      "version": 219,
      "versionNonce": 1063580293,
      "isDeleted": false,
      "id": "VM70UzyOD9Fw_Dl7902PF",
      "fillStyle": "hachure",
      "strokeWidth": 2,
      "strokeStyle": "solid",
      "roughness": 1,
      "opacity": 100,
      "angle": 0,
      "x": 578.7083339691162,
      "y": 648,
      "strokeColor": "#1971c2",
      "backgroundColor": "transparent",
      "width": 58.58333206176758,
      "height": 24,
      "seed": 713573989,
      "groupIds": [],
      "frameId": null,
      "roundness": null,
      "boundElements": [],
      "updated": 1688542356318,
      "link": null,
      "locked": false,
      "fontSize": 20,
      "fontFamily": 3,
      "text": "Tâche",
      "textAlign": "left",
      "verticalAlign": "top",
      "containerId": null,
      "originalText": "Tâche",
      "lineHeight": 1.2,
      "baseline": 19
    },
    {
      "id": "yo3s4c3q9YTUpQCAqBMWe",
      "type": "text",
      "x": 929,
      "y": 333,
      "width": 70.30000305175781,
      "height": 24,
      "angle": 0,
      "strokeColor": "#f08c00",
      "backgroundColor": "transparent",
      "fillStyle": "hachure",
      "strokeWidth": 2,
      "strokeStyle": "solid",
      "roughness": 1,
      "opacity": 100,
      "groupIds": [],
      "frameId": null,
      "roundness": null,
      "seed": 1186401445,
      "version": 91,
      "versionNonce": 192750667,
      "isDeleted": false,
      "boundElements": null,
      "updated": 1688542356318,
      "link": null,
      "locked": false,
      "text": "Module",
      "fontSize": 20,
      "fontFamily": 3,
      "textAlign": "left",
      "verticalAlign": "top",
      "baseline": 19,
      "containerId": null,
      "originalText": "Module",
      "lineHeight": 1.2,
      "isFrameName": false
    },
    {
      "type": "text",
      "version": 126,
      "versionNonce": 1368283621,
      "isDeleted": false,
      "id": "pGU3CLjetIQoK7MzmKF8Q",
      "fillStyle": "hachure",
      "strokeWidth": 2,
      "strokeStyle": "solid",
      "roughness": 1,
      "opacity": 100,
      "angle": 0,
      "x": 985.8499984741211,
      "y": 429,
      "strokeColor": "#f08c00",
      "backgroundColor": "transparent",
      "width": 70.30000305175781,
      "height": 24,
      "seed": 1152763653,
      "groupIds": [],
      "frameId": null,
      "roundness": null,
      "boundElements": [],
      "updated": 1688542356318,
      "link": null,
      "locked": false,
      "fontSize": 20,
      "fontFamily": 3,
      "text": "Module",
      "textAlign": "left",
      "verticalAlign": "top",
      "containerId": null,
      "originalText": "Module",
      "lineHeight": 1.2,
      "baseline": 19
    },
    {
      "type": "text",
      "version": 172,
      "versionNonce": 411591403,
      "isDeleted": false,
      "id": "_AUXnT1JHAGzjdlP_WUS-",
      "fillStyle": "hachure",
      "strokeWidth": 2,
      "strokeStyle": "solid",
      "roughness": 1,
      "opacity": 100,
      "angle": 0,
      "x": 928.8499984741211,
      "y": 645,
      "strokeColor": "#f08c00",
      "backgroundColor": "transparent",
      "width": 70.30000305175781,
      "height": 24,
      "seed": 1153936139,
      "groupIds": [],
      "frameId": null,
      "roundness": null,
      "boundElements": [],
      "updated": 1688542356318,
      "link": null,
      "locked": false,
      "fontSize": 20,
      "fontFamily": 3,
      "text": "Module",
      "textAlign": "left",
      "verticalAlign": "top",
      "containerId": null,
      "originalText": "Module",
      "lineHeight": 1.2,
      "baseline": 19
    }
  ],
  "appState": {
    "gridSize": 20,
    "viewBackgroundColor": "#ffffff"
  }
}
```

# Commandes
## Exécuter un playbook
```bash
ansible-playbook [-i INVENTORY] PLAYBOOK
```

# Références
- [Using Ansible playbooks - Ansible Documentation](https://docs.ansible.com/ansible/latest/playbook_guide/index.html)
{.links-list}